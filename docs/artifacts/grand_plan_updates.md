# Grand Plan Updates - Based on User Feedback

**Date**: 2025-12-15  
**Updated By**: AI Assistant  
**Feedback Source**: User comments on grand_refactoring_plan.md

---

## Key Updates Made

### 1. Duration Calculation âœ… UPDATED
**Old**: Default 45 minutes for QSM  
**New**: Dynamic calculation based on question categories and difficulty

**Formula**:
```
Total Duration = SUM(questions Ã— time_per_difficulty) Ã— 1.1 (buffer)

Time per difficulty:
- Easy: 10 minutes
- Medium: 15 minutes
- Hard: 20 minutes

Example:
1 easy coding + 1 medium conceptual + 1 hard system_design
= (10 + 15 + 20) Ã— 1.1
= 45 Ã— 1.1
= ~50 minutes
```

**Implementation**: Added to `ConfigService.calculate_duration()`

---

### 2. Multi-Agent System âœ… SIMPLIFIED

**Planning Phase**:
- Interview Controller Agent (orchestrator)
- Critique Agent (reviews plan, suggests improvements)
- Observer Agent (analyzes HITL feedback, extracts learnings)
- **Max Sub-Agents**: 2 (Critique + Observer)
- **Max Iterations**: 1 critique cycle

**Execution Phase** (Future):
- Interview Controller Agent
- Critique Agent (quality monitor)
- Cheating Controller Agent (security)
- Advisor Agent (LLM score monitoring)
- Observer Agent (HITL feedback analysis)

**Evaluation Phase** (Future):
- Evaluation Controller Agent
- Critique Agent (report review)
- Observer Agent (learnings extraction)

**Key Decision**: No more than 2 sub-agents per phase to keep complexity manageable

---

### 3. Platform Capabilities - SSOT Created âœ…

**File**: `platform_capabilities_ssot.md`

**Includes**:
- âœ… 10 Languages (7 active, 3 TODO)
- âœ… 10+ Frameworks/Technologies
- âœ… 20+ Skills
- âœ… 5 Question Categories
- âœ… 3 Difficulty Levels
- âœ… 2 Interview Modes (QSM, CCM)
- âœ… 4 Followup Strategies
- âœ… 7 Position Templates
- âœ… 12+ Active Positions

**TODO Identified**:
- Consolidate question bank (currently split between `question_bank.json` and templates)
- Expand question banks for JS/TS, Go, Swift, Kotlin
- Add question banks for C++, Rust, Ruby

---

### 4. Database Choice âœ… MONGODB RECOMMENDED

**Analysis**:
| Feature | MongoDB | PostgreSQL + JSONB |
|---------|---------|-------------------|
| JSON Support | Native | JSONB type |
| Schema Flexibility | Excellent | Good |
| Horizontal Scaling | Easy | Harder |
| Query Performance | Good | Excellent |
| Transactions | Yes (4.0+) | Yes |
| Learning Curve | Moderate | Low (if know SQL) |

**Recommendation**: **MongoDB for Sessions**
- Native JSON = perfect for evolving SSOT
- Easier horizontal scaling to millions of sessions
- Document model matches session structure
- Can use PostgreSQL for structured data (users, positions)

**Hybrid Approach**:
- MongoDB: Session storage (SSOT)
- PostgreSQL: Users, positions, templates
- Redis: Caching, real-time data

---

### 5. Email Template âœ… PROFESSIONAL TEMPLATE CREATED

**Subject**: Interview Invitation - [Position] at [Company]

**Includes**:
- Interview details (position, duration, format)
- Technical requirements (browser, internet, environment)
- Interview structure (question count, categories)
- Preparation tips
- Interview link
- Contact information

**Generated by**: LLM (with expert editing capability)

---

### 6. Concurrency Limits âœ… DEFINED

| Resource | Start | Goal |
|----------|-------|------|
| Max Concurrent Interviews | 100 | 1,000,000 |
| WebSocket Connections/Session | 5 | 5 |
| Rate Limit (per IP) | 100 req/min | 100 req/min |
| Session File Size | 500 KB | 500 KB |

**Start Conservative, Scale Up**: Begin with 100 concurrent, prove stability, then scale

---

### 7. Integration Points âœ… DOCUMENTED

**Existing**:
- Wiki Service (`wiki.json`)
- DeepWiki Service (in development)
- System Prompt Service (in development)

**Future**:
- Email Service (SMTP/SendGrid)
- Video Recording
- Analytics Dashboard
- Candidate Portal

---

### 8. Focus: Planning Phase Only âœ… CONFIRMED

**Current Scope**: Planning Phase implementation
**Execution Phase**: Multi-agent system planned but not implemented yet
**Evaluation Phase**: Designed but not implemented yet

**Rationale**: Perfect one phase before moving to next

---

### 9. UI Alignment âœ… CONFIRMED

**User Feedback**: "UI wise we need to be aligned and cant have new design, this one is approved already"

**Action**: 
- Keep existing UI design
- Refactor components for better structure
- Remove hardcoded values
- Improve performance
- **No visual changes**

---

### 10. Strangler Fig Pattern âœ… CLARIFIED

**User Feedback**: "Most of the coding is there but in a bad condition we need to fix this"

**Approach**:
- Build new services alongside old code
- Gradually route traffic to new services
- Keep old code as fallback
- Remove old code only when new is proven
- **Zero downtime migration**

**Example**:
```
Old: main.py handles everything
New: PlanningService handles planning phase

Migration:
1. Create PlanningService (new code)
2. Add route to use PlanningService for new sessions
3. Old sessions continue using old code
4. Monitor and validate
5. Migrate all sessions to new code
6. Remove old planning code from main.py
```

---

### 11. Question Bank Consolidation ðŸ“‹ TODO

**Current State**:
- `backend/models/question_bank.json` - Main repository
- Question templates in code - Scattered

**Problem**: Two sources of truth

**Solution**:
1. Audit all question sources
2. Consolidate into `question_bank.json`
3. Remove hardcoded templates
4. Reference questions by ID
5. Create migration script

**Priority**: High (before expanding question banks)

---

### 12. Stub Implementations âœ… EXPANDED

**User Feedback**: "Add expert admin and candidate all for stubbing to see the behavior only"

**Updated AuthService**:
- Expert: `expert@company.com` / `expert123`
- Admin: `admin@company.com` / `admin123`
- Candidate: `candidate@company.com` / `candidate123`

**Purpose**: Test different user flows without real authentication

---

## Answers to User Questions

### Q1: QSM Defaults?
**A**: Not fixed duration. Calculated based on question distribution.
- Example: 1 easy + 1 medium + 1 hard = 45 min base + 10% buffer = ~50 min

### Q2: Platform Capabilities?
**A**: Created comprehensive SSOT document with:
- 10 languages (7 active, 3 TODO)
- 5 question categories
- 3 difficulty levels
- See `platform_capabilities_ssot.md`

### Q3: Multi-Agent Iterations?
**A**: 
- Max 2 sub-agents per phase
- 1 critique iteration in Planning Phase
- Show expert both original and critiqued plans

### Q4: Email Template?
**A**: Professional template created with all necessary details
- LLM-generated
- Expert can edit before sending

### Q5: Concurrency?
**A**: 
- Start: 100 concurrent users
- Goal: 1,000,000 (scale gradually)
- Rate limit: 100 req/min per IP

---

## Next Steps

1. âœ… Review and approve updated plans
2. âœ… Start Phase 1 implementation (Mini Tasks)
3. ðŸ“‹ Setup MongoDB for development
4. ðŸ“‹ Consolidate question bank
5. ðŸ“‹ Begin TDD implementation of foundation services

---

## Files Created

1. **platform_capabilities_ssot.md** - Complete SSOT for platform
2. **mini_tasks_phase1.md** - Detailed implementation tasks
3. **grand_plan_updates.md** - This document

---

## Ready to Proceed?

All feedback incorporated. Ready to start implementation with:
- âœ… Clear scope (Planning Phase only)
- âœ… TDD approach
- âœ… Strangler Fig pattern
- âœ… MongoDB for sessions
- âœ… No UI changes
- âœ… Detailed mini-tasks
- âœ… 100% test coverage requirement

**Next Action**: Start MT-1.1 (Create Platform Capabilities JSON)
