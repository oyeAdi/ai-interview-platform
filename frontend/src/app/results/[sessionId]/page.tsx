'use client'

import { useEffect, useState } from 'react'
import { apiUrl } from '@/config/api'

export default function PublicResultPage({ params }: { params: { sessionId: string } }) {
    const [loading, setLoading] = useState(true)
    const [status, setStatus] = useState<'PENDING' | 'APPROVED' | 'NOT_FOUND'>('PENDING')
    const [report, setReport] = useState<string | null>(null)

    useEffect(() => {
        const fetchResult = async () => {
            try {
                const response = await fetch(apiUrl(`api/results/${params.sessionId}/status`))
                if (response.ok) {
                    const data = await response.json()
                    setStatus(data.status)
                    if (data.status === 'APPROVED' && data.content) {
                        setReport(data.content)
                    }
                } else {
                    setStatus('NOT_FOUND')
                }
            } catch (error) {
                console.error('Failed to fetch result:', error)
                setStatus('NOT_FOUND')
            } finally {
                setLoading(false)
            }
        }

        fetchResult()
    }, [params.sessionId])

    if (loading) {
        return (
            <div className="min-h-screen bg-[#0A0A0A] flex items-center justify-center">
                <div className="w-8 h-8 border-2 border-[#00E5FF]/30 border-t-[#00E5FF] rounded-full animate-spin"></div>
            </div>
        )
    }

    if (status === 'NOT_FOUND') {
        return (
            <div className="min-h-screen bg-[#0A0A0A] text-white flex items-center justify-center p-4">
                <div className="text-center">
                    <h1 className="text-2xl font-bold text-gray-200">Result Not Found</h1>
                    <p className="text-gray-400 mt-2">The requested interview result could not be found or is invalid.</p>
                </div>
            </div>
        )
    }

    if (status === 'PENDING') {
        return (
            <div className="min-h-screen bg-[#0A0A0A] text-white flex items-center justify-center p-4">
                <div className="text-center max-w-md">
                    <div className="w-16 h-16 bg-[#2A2A2A] rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse">
                        <svg className="w-8 h-8 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <h1 className="text-2xl font-bold text-white mb-2">Results Under Review</h1>
                    <p className="text-gray-400">
                        This interview report is currently being reviewed by our team. Please check back later using this link.
                    </p>
                </div>
            </div>
        )
    }

    return (
        <div className="min-h-screen bg-[#0A0A0A] text-white p-8 font-sans print:bg-white print:text-black print:p-0">
            <div className="max-w-4xl mx-auto space-y-8 print:max-w-none">
                {/* Header - Hidden on Print */}
                <div className="text-center space-y-4 print:hidden">
                    <div className="w-16 h-16 bg-[#00E5FF]/10 rounded-full flex items-center justify-center mx-auto mb-6">
                        <svg className="w-8 h-8 text-[#00E5FF]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <h1 className="text-4xl font-bold bg-gradient-to-r from-white to-gray-400 bg-clip-text text-transparent">
                        Interview Feedback Report
                    </h1>
                </div>

                {/* Content Area */}
                <div className="bg-[#141414] border border-[#2A2A2A] rounded-2xl p-8 shadow-2xl min-h-[400px] flex flex-col print:border-none print:shadow-none print:bg-white print:text-black print:p-0">
                    <div className="flex items-center justify-between border-b border-[#2A2A2A] pb-6 mb-6 print:hidden">
                        <div>
                            <h2 className="text-2xl font-bold text-[#39FF14]">Confidential Evaluation</h2>
                            <p className="text-gray-400 text-sm mt-1">
                                Generated by AI Interview Feedback Assistant
                            </p>
                        </div>
                        <button
                            onClick={() => window.print()}
                            className="px-4 py-2 bg-[#2A2A2A] hover:bg-[#333] text-gray-300 rounded-lg text-sm transition-colors flex items-center gap-2"
                        >
                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                            Download PDF
                        </button>
                    </div>

                    {/* Print Header */}
                    <div className="hidden print:block border-b-2 border-black pb-4 mb-6">
                        <h1 className="text-2xl font-bold">Interview Feedback Report</h1>
                        <p className="text-sm text-gray-600">Generated by AI Interview Platform</p>
                    </div>

                    <div className="prose prose-invert max-w-none print:prose p-6 bg-[#0A0A0A] rounded-xl border border-[#2A2A2A] print:bg-transparent print:border-none print:p-0">
                        <pre className="whitespace-pre-wrap font-sans text-gray-300 text-base leading-relaxed print:text-black print:font-serif">
                            {report}
                        </pre>
                    </div>

                    <div className="mt-8 pt-8 border-t border-[#2A2A2A] text-center text-xs text-gray-500 print:text-gray-400 print:mt-12">
                        <p>This report contains confidential information. Unauthorized distribution is prohibited.</p>
                        <p className="mt-1">Â© {new Date().getFullYear()} AI Interview Platform</p>
                    </div>
                </div>
            </div>
        </div>
    )
}
